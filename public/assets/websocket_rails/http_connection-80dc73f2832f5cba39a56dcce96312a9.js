(function(){var t=function(t,e){function o(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},n={}.hasOwnProperty;WebSocketRails.HttpConnection=function(n){function e(t,n){var o,r;this.dispatcher=n,e.__super__.constructor.apply(this,arguments),this._url="http://"+t,this._conn=this._createXMLHttpObject(),this.last_pos=0;try{this._conn.onreadystatechange=function(t){return function(){return t._parse_stream()}}(this),this._conn.addEventListener("load",this.on_close,!1)}catch(r){o=r,this._conn.onprogress=function(t){return function(){return t._parse_stream()}}(this),this._conn.onload=this.on_close,this._conn.readyState=3}this._conn.open("GET",this._url,!0),this._conn.send()}return t(e,n),e.prototype.connection_type="http",e.prototype._httpFactories=function(){return[function(){return new XDomainRequest},function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}]},e.prototype.close=function(){return this._conn.abort()},e.prototype.send_event=function(t){return e.__super__.send_event.apply(this,arguments),this._post_data(t.serialize())},e.prototype._post_data=function(t){return $.ajax(this._url,{type:"POST",data:{client_id:this.connection_id,data:t},success:function(){}})},e.prototype._createXMLHttpObject=function(){var t,n,e,o,r,s,c;for(c=!1,e=this._httpFactories(),r=0,s=e.length;s>r;r++){o=e[r];try{c=o()}catch(n){t=n;continue}break}return c},e.prototype._parse_stream=function(){var t,n,e,o;if(3===this._conn.readyState){t=this._conn.responseText.substring(this.last_pos),this.last_pos=this._conn.responseText.length,t=t.replace(/\]\]\[\[/g,"],[");try{return o=JSON.parse(t),this.on_message(o)}catch(e){n=e}}},e}(WebSocketRails.AbstractConnection)}).call(this);